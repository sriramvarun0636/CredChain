import React, { useEffect } from 'react';
import { useAuth0 } from '@auth0/auth0-react';
import { Link, useNavigate, useLocation } from 'react-router-dom';
import axios from 'axios';

export default function Navbar() {
    const { loginWithRedirect, logout, user, isAuthenticated, isLoading } = useAuth0();
    const navigate = useNavigate();
    const location = useLocation();

    useEffect(() => {
        const login_func = async () => {
            try {
                const response = await axios.get('/isregistered', {
                    params: { email: user.email }
                });

                if (response.status === 200 && location.pathname === '/') {
                    navigate('/');
                }
            } catch (error) {
                console.error('Error during registration check:', error);
                if (location.pathname === '/') {
                    navigate('/signup');
                }
            }
        };

        if (isAuthenticated && user && user.email && !isLoading) {
            login_func();
        }
    }, [isAuthenticated, isLoading, user, navigate, location.pathname]);

    const logout_func = async () => {
        try{
          const response=await axios.get('/logout');
          if(response.status===200){
    
            logout({ logoutParams: { returnTo: window.location.origin } });
          }
        }
        catch(err){
          console.log(err);
        }
    
      };

    return (
        <nav className="w-full pl-12 pr-16 py-4 bg-gradient-to-r from-[#181f3a] to-[#2a4365] flex items-center justify-between shadow sticky top-0 z-50">

            {/* Logo and Brand */}
            <Link to="/" className="flex items-center space-x-0">
                <svg
                    className="h-10 w-20 align-middle"
                    viewBox="0 0 704 416"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    style={{ display: "block" }}
                >
                    <defs>
                        <linearGradient id="credchain-gradient" x1="0" y1="0" x2="704" y2="416" gradientUnits="userSpaceOnUse">
                            <stop stopColor="#3b82f6"/>
                            <stop offset="0.5" stopColor="#a21caf"/>
                            <stop offset="1" stopColor="#ec4899"/>
                        </linearGradient>
                    </defs>
                    <path
                        fill="url(#credchain-gradient)"
                        opacity="1.000000"
                        stroke="none"
                        d="
                            M458.999878,339.331055 
                            C440.838898,339.329407 423.177795,339.290039 405.517120,339.365417 
                            C402.529724,339.378174 400.121674,338.732635 397.887695,336.535400 
                            C386.606140,325.439117 375.239441,314.427826 363.785950,303.509125 
                            C361.118805,300.966553 360.999878,299.217804 363.838043,296.645844 
                            C375.438599,286.133484 386.975098,275.544006 398.284973,264.721375 
                            C401.651611,261.499786 403.851562,261.665649 406.803101,265.022278 
                            C409.652222,268.262451 413.441101,270.726562 416.040558,274.125488 
                            C421.281921,280.979004 428.011688,282.252533 436.191132,282.084564 
                            C458.841217,281.619507 481.506683,281.837341 504.165497,281.928345 
                            C507.914001,281.943390 510.735565,280.923889 513.430298,278.166534 
                            C520.294434,271.142853 527.419983,264.367920 534.599854,257.663544 
                            C536.849670,255.562698 537.869141,253.388351 537.858276,250.281708 
                            C537.763916,223.290787 537.783020,196.299393 537.830994,169.308228 
                            C537.835999,166.494308 537.211548,164.235367 535.050781,162.189362 
                            C527.431335,154.974701 519.917358,147.645279 512.497009,140.225784 
                            C510.338440,138.067505 508.081512,137.084030 505.002380,137.095718 
                            C479.677582,137.192001 454.352203,137.190857 429.027222,137.131409 
                            C426.018707,137.124344 423.689575,138.004608 421.372864,139.992676 
                            C385.107849,171.113068 348.777618,202.157532 312.429901,233.181351 
                            C310.766998,234.600693 309.257294,237.233749 306.531464,235.735443 
                            C303.730988,234.196075 301.618408,232.167160 301.654633,228.308960 
                            C301.817200,210.982880 301.797607,193.653473 301.630798,176.327316 
                            C301.599182,173.043289 303.182281,171.125320 305.316345,169.145172 
                            C331.932617,144.448685 358.526031,119.727585 385.110504,94.996895 
                            C389.378204,91.026764 393.651398,87.056717 397.772186,82.936737 
                            C400.073090,80.636299 402.683411,79.799591 405.860474,79.801842 
                            C446.513947,79.830635 487.167480,79.826859 527.820862,79.744377 
                            C531.222046,79.737480 533.768188,80.765999 536.227661,83.184540 
                            C554.633850,101.284180 573.131592,119.291199 591.693787,137.230972 
                            C594.221375,139.673874 594.962219,142.392029 594.956177,145.727798 
                            C594.902527,175.373047 594.969727,205.018539 594.911865,234.663788 
                            C594.885559,248.152817 594.601562,261.641327 594.569275,275.130371 
                            C594.562805,277.851227 593.686951,279.873322 591.764099,281.738312 
                            C572.872070,300.061676 553.992615,318.398315 535.209045,336.832520 
                            C532.906006,339.092682 530.374512,339.358978 527.477417,339.354004 
                            C504.818329,339.315094 482.159088,339.332153 458.999878,339.331055 
                        z"
                    />
                    <path
                        fill="url(#credchain-gradient)"
                        opacity="1.000000"
                        stroke="none"
                        d="
                            M106.724838,225.999863 
                            C106.732689,199.169128 106.824104,172.837906 106.663429,146.508209 
                            C106.637711,142.292587 108.013115,139.384613 110.995987,136.494720 
                            C128.942505,119.107643 146.762039,101.588440 164.504257,83.992622 
                            C167.305847,81.214142 170.225891,79.845375 174.198029,79.848663 
                            C214.860428,79.882324 255.522964,79.817245 296.185303,79.718109 
                            C299.030914,79.711174 301.331421,80.472939 303.383148,82.476112 
                            C314.705261,93.530464 326.048767,104.563530 337.468079,115.517204 
                            C339.896240,117.846382 340.209900,119.559814 337.505524,122.024567 
                            C325.811066,132.682877 314.171661,143.406693 302.737885,154.342606 
                            C299.703430,157.244919 297.847565,157.120621 295.064697,154.144989 
                            C290.519257,149.284653 285.464569,144.904312 280.815277,140.135727 
                            C278.505188,137.766388 275.929504,137.118790 272.750549,137.128372 
                            C247.420013,137.204742 222.088989,137.196411 196.758438,137.114105 
                            C193.562195,137.103714 191.144699,137.925278 188.819626,140.314438 
                            C181.732880,147.596573 174.446243,154.690826 167.067307,161.678589 
                            C164.296509,164.302505 163.259048,167.171265 163.276886,170.954788 
                            C163.400238,197.118271 163.386932,223.282684 163.303436,249.446426 
                            C163.293625,252.518799 164.203323,254.738556 166.449417,256.884796 
                            C174.037155,264.135376 181.483688,271.537689 188.841873,279.021912 
                            C190.878021,281.092957 193.031647,282.007538 195.897614,281.998108 
                            C221.561417,281.913544 247.225494,281.885193 272.889435,281.904694 
                            C275.730164,281.906860 277.998993,281.023102 280.101990,279.115356 
                            C315.395508,247.097809 351.920837,216.500931 388.186066,185.605606 
                            C389.913696,184.133789 391.496246,180.944580 394.344574,182.429047 
                            C397.448395,184.046692 399.929047,186.607712 399.902100,190.677811 
                            C399.784119,208.499283 399.707184,226.321030 399.650848,244.142807 
                            C399.642853,246.673935 397.824860,247.988388 396.278320,249.432404 
                            C380.571228,264.098755 364.763062,278.657410 349.113159,293.384369 
                            C333.830078,307.766113 318.672058,322.281311 303.534241,336.816101 
                            C301.708832,338.568756 299.837433,339.363770 297.333130,339.361176 
                            C255.670639,339.318024 214.008057,339.314941 172.345581,339.362671 
                            C169.820068,339.365540 167.904190,338.547699 166.128998,336.801880 
                            C147.358612,318.342377 128.572250,299.898956 109.718475,281.524750 
                            C107.504631,279.367218 106.670074,277.041473 106.689171,273.994324 
                            C106.788361,258.163391 106.729027,242.331467 106.724838,225.999863 
                        z"
                    />
                </svg>
                <span className="text-2xl font-bold leading-none -ml-2 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-transparent bg-clip-text">
                    CredChain
                </span>
            </Link>

            {/* Navigation Links */}
            <div className="flex items-center space-x-8">
                <Link to="/about" className="text-white text-lg font-medium hover:text-pink-400 transition">
                    About Us
                </Link>
                <Link to="/how-it-works" className="text-white text-lg font-medium hover:text-pink-400 transition">
                    How It Works
                </Link>
                <Link to="/why-credchain" className="text-white text-lg font-medium hover:text-pink-400 transition">
                    Why CredChain?
                </Link>
                <Link to="/contact" className="text-white text-lg font-medium hover:text-pink-400 transition">
                    Contact Us
                </Link>
                {user&&<Link to="/credit-score" className="text-white text-lg font-medium hover:text-pink-400 transition">
                    View Score
                </Link>}

                {user&&<Link to="/financial-details" className="text-white text-lg font-medium hover:text-pink-400 transition">
                    Update Details
                </Link>}



                
                {!isAuthenticated ? (
                    <button
                        onClick={() => loginWithRedirect()}
                        className="ml-4 px-4 py-2 bg-gradient-to-r from-purple-400 to-pink-400 rounded-lg text-white font-semibold shadow hover:scale-105 transition"
                    >
                        Log In
                    </button>
                ) : (
                    <button
                        onClick={logout_func}
                        className="ml-4 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-semibold shadow hover:scale-105 transition"
                    >
                        Log Out
                    </button>
                )}
            </div>
        </nav>
    );
}
